<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Manajemen Pekerjaan</title>
    <style>
        /* === CSS Sederhana (Sama dengan sebelumnya, tapi dimasukkan ke HTML) === */
        body { font-family: Arial, sans-serif; background-color: #f0f2f5; margin: 0; padding: 0; color: #333; }
        .container { max-width: 1200px; margin: 20px auto; background-color: #ffffff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); overflow: hidden; padding-bottom: 20px; }
        .hidden { display: none; }
        
        /* Navigasi */
        nav { background-color: #007bff; color: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; }
        nav h1 { margin: 0; font-size: 24px; }
        #notification-bell { font-size: 20px; cursor: pointer; }
        #logout-button { background-color: #dc3545; color: white; border: none; padding: 8px 14px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; }
        #logout-button:hover { background-color: #c82333; }
        
        /* Login dan Modul */
        #login-page { padding: 40px; text-align: center; }
        #login-page h1 { color: #007bff; font-size: 28px; margin-bottom: 20px; }
        .module { background-color: #fcfcfc; border: 1px solid #e9e9e9; padding: 20px; margin-bottom: 20px; border-radius: 8px; margin: 0 25px 20px 25px;}
        
        .module input, .module select { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 14px; }
        .module button, #login-button { width: 100%; padding: 12px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 10px; transition: background-color 0.2s; }
        .module button:hover, #login-button:hover { background-color: #0056b3; }
        
        /* Dashboard Views */
        #owner-view, #worker-view { padding: 25px; }
        
        /* Laporan */
        .report-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center; margin-bottom: 30px; }
        .report-card { background-color: #f0f8ff; padding: 20px; border: 1px solid #bde0ff; border-radius: 8px; }
        .report-card h3 { margin: 0 0 10px 0; color: #555; font-size: 16px; }
        .report-card p { font-size: 28px; font-weight: bold; color: #007bff; margin: 0; }
        
        /* Job List */
        .job-list { padding: 0 25px; }
        .job-list .job-item { border: 1px solid #ddd; padding: 15px 20px; margin-bottom: 10px; border-radius: 5px; background-color: #fff; border-left: 5px solid #007bff; }
        .job-item.completed { background-color: #f9f9f9; border-left-color: #28a745; opacity: 0.8; }
        .job-item strong { color: #0056b3; font-size: 18px; display: block; margin-bottom: 5px; }
        .job-item .details { font-size: 14px; color: #666; margin: 10px 0; line-height: 1.5; }
        .job-item button { width: auto; background-color: #28a745; padding: 8px 15px; font-size: 14px; margin-top: 0;}
        .job-item button:hover { background-color: #218838; }
    </style>
</head>
<body>

    <div id="login-page" class="container">
        <h1>Sistem Jobku</h1>
        <p>Silakan Masuk untuk melanjutkan. (Simulasi Login)</p>
        <div class="module">
            <input type="text" id="login-username" placeholder="Masukkan ID/Email Anda (misal: owner, worker_a, staff_b)" required>
            <input type="password" placeholder="Kata Sandi (diabaikan dalam simulasi)" required>
            <button id="login-button">Masuk</button>
        </div>
        <p>Untuk mencoba, gunakan ID: <strong>owner</strong>, <strong>worker_a</strong>, atau <strong>staff_b</strong></p>
    </div>

    <div id="app-page" class="container hidden">
        <nav>
            <h1>Dashboard <span id="role-name"></span></h1>
            <div id="notification-bell">🔔 (0)</div>
            <button id="logout-button">Keluar</button>
        </nav>

        <div id="owner-view" class="hidden">
            <h2>Laporan Keuangan Bulanan (Simulasi)</h2>
            <div class="report-grid">
                <div class="report-card">
                    <h3>Total Orderan Masuk</h3>
                    <p id="report-total-orders">0</p>
                </div>
                <div class="report-card">
                    <h3>Total Omset Bulan Ini</h3>
                    <p id="report-total-omset">Rp 0</p>
                </div>
                <div class="report-card">
                    <h3>Total Gaji Pekerja (Selesai)</h3>
                    <p id="report-total-gaji">Rp 0</p>
                </div>
            </div>

            <h2>Input Orderan Baru (Customer)</h2>
            <div class="module">
                <input type="number" id="order-value" placeholder="Nilai Orderan (misal: 500000)">
                <button id="add-order-button">Tambah Orderan & Data ke Sheets</button>
            </div>
            
            <h2>Berikan Job Baru kepada Pekerja</h2>
            <div class="module">
                <input type="text" id="job-name" placeholder="Nama Pekerjaan (misal: Desain Logo Klien A)">
                <select id="job-assignee">
                    <option value="worker_a">Worker A</option>
                    <option value="staff_b">Staf B</option>
                    <option value="worker_c">Worker C</option>
                </select>
                <input type="datetime-local" id="job-deadline" title="Deadline Waktu Pengerjaan">
                <input type="number" id="job-reward" placeholder="Gaji/Hasil Pekerja untuk Job ini">
                <button id="add-job-button">Berikan Job & Kirim Notifikasi</button>
            </div>
        </div>
        
        <div id="worker-view" class="hidden">
            <h2>Daftar Pekerjaan Anda (Perlu Selesai)</h2>
            <div id="worker-job-list" class="job-list">
                <p>Tidak ada pekerjaan yang menunggu.</p>
            </div>
        </div>

        <h2>Monitoring Semua Pekerjaan</h2>
        <div id="all-job-list" class="job-list">
            <p>Belum ada data pekerjaan.</p>
        </div>
    </div>

<script>
    // === SIMULASI DATABASE LOKAL (Data akan hilang saat refresh) ===
    // Untuk fitur permanen, Anda HARUS menggunakan Apps Script seperti panduan di bawah.
    let db_jobs = []; 
    let db_orders = []; 
    let db_users = {
        'owner': { role: 'owner', name: 'Owner' },
        'worker_a': { role: 'worker', name: 'Worker A' },
        'staff_b': { role: 'staff', name: 'Staf B' },
        'worker_c': { role: 'worker', name: 'Worker C' },
    };
    let currentUserRole = '';
    let currentUserID = ''; 

    // === ELEMEN PENTING ===
    const loginPage = document.getElementById('login-page');
    const appPage = document.getElementById('app-page');
    const roleName = document.getElementById('role-name');
    const ownerView = document.getElementById('owner-view');
    const workerView = document.getElementById('worker-view');
    const allJobList = document.getElementById('all-job-list');
    const workerJobList = document.getElementById('worker-job-list');
    const notificationBell = document.getElementById('notification-bell');

    // === FUNGSI UTAMA ===

    // Login (Simulasi)
    document.getElementById('login-button').addEventListener('click', function() {
        const userID = document.getElementById('login-username').value.toLowerCase();
        
        if (!db_users[userID]) {
            alert("ID pengguna tidak ditemukan. Gunakan ID demo: owner, worker_a, atau staff_b.");
            return;
        }

        currentUserID = userID;
        currentUserRole = db_users[userID].role;

        // Tampilkan tampilan yang sesuai
        roleName.textContent = `(${db_users[currentUserID].name} - ${currentUserRole.toUpperCase()})`;
        ownerView.classList.toggle('hidden', currentUserRole !== 'owner');
        workerView.classList.toggle('hidden', currentUserRole === 'owner');
        
        loginPage.classList.add('hidden');
        appPage.classList.remove('hidden');
        
        refreshAllViews();
    });

    // Logout
    document.getElementById('logout-button').addEventListener('click', function() {
        currentUserRole = '';
        currentUserID = '';
        loginPage.classList.remove('hidden');
        appPage.classList.add('hidden');
    });

    // Tambah Order (Owner)
    document.getElementById('add-order-button').addEventListener('click', function() {
        const orderValue = parseInt(document.getElementById('order-value').value);
        if (orderValue > 0) {
            db_orders.push({ id: Date.now(), value: orderValue, date: new Date() });
            alert(`Order Rp ${orderValue.toLocaleString('id-ID')} ditambahkan. (Harusnya ke Sheets!)`);
            document.getElementById('order-value').value = '';
            updateReports();
        } else {
            alert("Masukkan nilai orderan yang valid.");
        }
    });

    // Tambah Job (Owner)
    document.getElementById('add-job-button').addEventListener('click', function() {
        const jobName = document.getElementById('job-name').value;
        const assigneeId = document.getElementById('job-assignee').value;
        const jobDeadline = document.getElementById('job-deadline').value;
        const jobReward = parseInt(document.getElementById('job-reward').value);

        if (jobName && assigneeId && jobDeadline && jobReward > 0) {
            const newJob = {
                id: Date.now(),
                name: jobName,
                assigneeId: assigneeId,
                assigneeName: db_users[assigneeId].name,
                deadline: new Date(jobDeadline),
                reward: jobReward,
                status: 'pending',
                dateAssigned: new Date()
            };
            db_jobs.push(newJob);
            
            // Simulasi Notifikasi
            alert(`NOTIFIKASI: Job baru diberikan kepada ${db_users[assigneeId].name}: "${jobName}"`);
            
            // Reset form
            document.getElementById('job-name').value = '';
            document.getElementById('job-deadline').value = '';
            document.getElementById('job-reward').value = '';
            
            refreshAllViews();
        } else {
            alert("Harap isi semua data pekerjaan dengan lengkap.");
        }
    });

    // Selesai Job (Worker)
    window.completeJob = function(jobId) {
        const job = db_jobs.find(j => j.id === jobId);
        if (job && job.assigneeId === currentUserID) {
            job.status = 'completed';
            job.dateCompleted = new Date();
            alert(`Pekerjaan "${job.name}" telah Selesai! Data gaji terhitung. (Harusnya ke Sheets!)`);
            refreshAllViews();
        } else {
            alert("Ini bukan tugas Anda atau terjadi kesalahan.");
        }
    }

    // === RENDER & REFRESH ===
    
    function refreshAllViews() {
        renderAllJobList();
        renderWorkerJobList();
        updateReports();
        updateNotifications();
    }

    function renderAllJobList() {
        const listHTML = db_jobs.map(job => {
            const statusText = job.status === 'completed' ? 'SELESAI ✅' : 'PENDING ⏳';
            return `
                <div class="job-item ${job.status}">
                    <strong>${job.name}</strong> (Status: ${statusText})
                    <div class="details">
                        Untuk: ${job.assigneeName} | 
                        Deadline: ${job.deadline.toLocaleString('id-ID')} | 
                        Gaji/Hasil: Rp ${job.reward.toLocaleString('id-ID')}
                    </div>
                </div>
            `;
        }).join('');
        allJobList.innerHTML = listHTML || '<p>Belum ada data pekerjaan.</p>';
    }

    function renderWorkerJobList() {
        const myPendingJobs = db_jobs.filter(job => job.assigneeId === currentUserID && job.status === 'pending');

        if (myPendingJobs.length === 0) {
            workerJobList.innerHTML = '<p>🎉 Semua tugas selesai! Tidak ada pekerjaan yang menunggu.</p>';
            return;
        }

        const listHTML = myPendingJobs.map(job => {
            return `
                <div class="job-item">
                    <strong>${job.name}</strong>
                    <div class="details">
                        Deadline: ${job.deadline.toLocaleString('id-ID')} | 
                        Gaji: Rp ${job.reward.toLocaleString('id-ID')}
                    </div>
                    <button onclick="completeJob(${job.id})">Tandai Selesai</button>
                </div>
            `;
        }).join('');
        workerJobList.innerHTML = listHTML;
    }

    function updateReports() {
        const totalOmset = db_orders.reduce((sum, order) => sum + order.value, 0);
        const totalGaji = db_jobs.filter(job => job.status === 'completed')
                                 .reduce((sum, job) => sum + job.reward, 0);

        // Anggap data ini adalah data bulanan untuk simulasi
        document.getElementById('report-total-orders').textContent = db_orders.length;
        document.getElementById('report-total-omset').textContent = `Rp ${totalOmset.toLocaleString('id-ID')}`;
        document.getElementById('report-total-gaji').textContent = `Rp ${totalGaji.toLocaleString('id-ID')}`;
    }

    function updateNotifications() {
        let count = 0;
        if (currentUserRole === 'owner') {
            count = db_jobs.filter(j => j.status === 'completed').length;
            notificationBell.title = `${count} pekerjaan telah selesai`;
        } else {
            count = db_jobs.filter(j => j.assigneeId === currentUserID && j.status === 'pending').length;
            notificationBell.title = `${count} pekerjaan baru menunggu`;
        }
        notificationBell.textContent = `🔔 (${count})`;
    }
</script>
</body>
</html>
